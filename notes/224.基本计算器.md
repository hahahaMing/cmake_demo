# [224. 基本计算器](https://leetcode-cn.com/problems/basic-calculator/)

实现一个基本的计算器来计算一个简单的字符串表达式 `s` 的值。

 

**示例 1：**

```
输入：s = "1 + 1"
输出：2
```

**示例 2：**

```
输入：s = " 2-1 + 2 "
输出：3
```

**示例 3：**

```
输入：s = "(1+(4+5+2)-3)+(6+8)"
输出：23
```

 

**提示：**

- `1 <= s.length <= 3 * 105`
- `s` 由数字、`'+'`、`'-'`、`'('`、`')'`、和 `' '` 组成
- `s` 表示一个有效的表达式

```c++
class Solution {
    std::string my_s;
    int n;

    int sum_in_brackets(int& start){
        //输入括号开始位，输出括号内的计算值,同时将i变为对应括回一位的值
        bool is_add = true;
        std::string num;
        int rst = 0;
        int i = start+1;
        while (i<n){
            if (my_s[i] == ' ' ) {
                i++;
                continue;
            }
            if (my_s[i] >= '0' && my_s[i] <= '9')num.push_back(my_s[i]);
            else{

                if (my_s[i]=='('){
                    rst+=is_add?sum_in_brackets(i):-sum_in_brackets(i);
                    i++;
                    continue;
                }
                int tmp = num.empty()?0:std::stoi(num);
                rst += is_add ? tmp : -tmp;
                num = "";
                if (my_s[i]==')')break;
                if (my_s[i] == '+') {
                    is_add = true;
                } else if (my_s[i] == '-') {
                    is_add = false;
                }
            }
            i++;
        }
        start = i;
        if (my_s[i]!=')'){
            int tmp = num.empty()?0:std::stoi(num);
            rst += is_add ? tmp : -tmp;
        }
        return rst;
    }

public:
    int calculate(std::string s) {
        my_s = s;
        n = s.size();
        int i = -1;
        return sum_in_brackets(i);
    }
};
```

> 执行用时：24 ms, 在所有 C++ 提交中击败了41.60% 的用户
>
> 内存消耗：8.4 MB, 在所有 C++ 提交中击败了58.33% 的用户

题解时是扫描时把所有括号打开，计算每一个数字前面的正负号，运用栈结构，记录括号前的符号，栈顶为＋看到+号就加，看到-就减，栈顶为-则反过来，看到符号后接数字直接把数字×符号加上就行，看到"("就压入括号前符号与栈顶符号乘积，看到")"就pop一下。

```c++
class Solution {
public:
    int calculate(string s) {
        stack<int> ops;
        ops.push(1);
        int sign = 1;

        int ret = 0;
        int n = s.length();
        int i = 0;
        while (i < n) {
            if (s[i] == ' ') {
                i++;
            } else if (s[i] == '+') {
                sign = ops.top();
                i++;
            } else if (s[i] == '-') {
                sign = -ops.top();
                i++;
            } else if (s[i] == '(') {
                ops.push(sign);
                i++;
            } else if (s[i] == ')') {
                ops.pop();
                i++;
            } else {
                long num = 0;
                while (i < n && s[i] >= '0' && s[i] <= '9') {
                    num = num * 10 + s[i] - '0';
                    i++;
                }
                ret += sign * num;
            }
        }
        return ret;
    }
};
```



